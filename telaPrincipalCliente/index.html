<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../style.css">
    </head>

    <body>

        <header class="headerInterno">
            <a href="login/index.html" class="linkPag">Exportar</a>
            <a href="cadastrarProfissional/index.html" class="linkPag">Hist√≥rico</a>
            <a href="cadastrarCliente/index.html" class="linkPag">Agenda</a>
            <a href="cadastrarCliente/index.html" class="linkPag">Novo Agendamento</a>
            <a href="cadastrarCliente/index.html" class="linkPag">Perfil</a>
        </header>

        <div class="divPrincipal">
            <p class="textoTitulo">Seus agendamentos de cliente</p>
            <p class = "textoDestaque" style=" margin-bottom: 5px;">Dia</p>
            <div class="duplaBotoes">
                <input type="date" class="campoInput" id="filtro" style="width: 200px; height: 30px;">
                <button class="botaoSubmit" id="btn_filtro" style=" margin-top: 5px; height:30px; width: 100px;">Filtrar</button>
                <button class="botaoSubmit" id="limpar" style=" margin-top: 5px; height: 30px; width: 100px;">Limpar</button>
            </div>
            
            <div id="resultado">
                <p>carregando...</p>
            </div>
            
        </div>

        <script>

            function pegarAgendamentos() {
                const filtro = document.getElementById("filtro").value;

                let url = "../phpAPIs/usuarioAgendamentosCliente.php";

                // se data adicionada = coloca na Url
                if (filtroData) {
                    url += `?data=${filtroData}`; 
                }

                fetch(url)
                .then(response => response.json())
                .then(data => {
                    const resultadoDiv = document.querySelector("#resultado");
                    resultadoDiv.innerHTML = ''; 

                    if (data.sucesso && data.agendamentos.length > 0) {
                        let html = '<ul>';
                        data.agendamentos.forEach(ag => {
                            const dataFormatada = new Date(ag.data_hora_inicio).toLocaleString('pt-BR');
                            html += `<li>
                                <p class="textoDestaque">${ag.nome_servico}</p> 
                                <p class="textoComum">com ${ag.nome_profissional}</p>
                                <p class="textoComum">Em: ${dataFormatada}</p>
                            </li>`;
                        });
                        html += '</ul>';
                        resultadoDiv.innerHTML = html;
                    } else if (data.sucesso) {
                        // Mensagem de "nenhum encontrado"
                        resultadoDiv.textContent = "Nenhum agendamento encontrado para esta data.";
                    } else {
                        resultadoDiv.style.color = 'red';
                        resultadoDiv.textContent = "erro: ${data.mensagem}";
                    }
                })
                .catch(err => {
                    console.error("Erro no fetch:", err);
                    const resultadoDiv = document.querySelector("#resultado");
                    resultadoDiv.style.color = 'red';
                    resultadoDiv.textContent = "erro ao carregar os dados";
                });                 
            }

            document.addEventListener('DOMContentLoaded', function() {
                
                pegarAgendamentos();
                document.getElementById("btn_filtro").addEventListener("click", pegarAgendamentos);
                document.getElementById("limpar").addEventListener("click", function() {
                    document.getElementById("filtro").value = "";
                    pegarAgendamentos();
                });
            });


        </script>
    </body>
</html>